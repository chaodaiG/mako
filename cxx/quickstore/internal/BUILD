package(default_visibility = [
    "//cxx/quickstore:__subpackages__",
    "//go/internal/quickstore_microservice:__pkg__",
    "//go/quickstore:__subpackages__",
    "//helpers/dart/quickstore:__subpackages__",
    "//helpers/py/quickstore:__subpackages__",
    "//java/com/google/testing/performance/mako/helpers/quickstore:__subpackages__",
])

licenses(["notice"])

cc_library(
    name = "store",
    srcs = ["store.cc"],
    hdrs = ["store.h"],
    deps = [
        "//cxx/clients/aggregator:standard_aggregator",
        "//cxx/clients/analyzers:threshold_analyzer",
        "//cxx/clients/analyzers:utest_analyzer",
        "//cxx/clients/analyzers:window_deviation",
        "//cxx/clients/dashboard:standard_dashboard",
        "//cxx/clients/downsampler:standard_downsampler",
        "//cxx/clients/fileio:memory_fileio",
        "//cxx/clients/storage:mako_client",
        "//cxx/helpers/rolling_window_reducer:rolling_window_reducer_internal",
        "//cxx/helpers/status",
        "//cxx/internal/load/common:run_analyzers",
        "//cxx/spec:aggregator",
        "//cxx/spec:analyzer",
        "//cxx/spec:downsampler",
        "//cxx/spec:fileio",
        "//cxx/spec:storage",
        "//proto/clients/analyzers:threshold_analyzer_cc_proto",
        "//proto/clients/analyzers:utest_analyzer_cc_proto",
        "//proto/clients/analyzers:window_deviation_cc_proto",
        "//proto/quickstore:quickstore_cc_proto",
        "//spec/proto:mako_cc_proto",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/memory",
        "@com_google_absl//absl/random",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/synchronization",
        "@com_google_absl//absl/time",
        "@com_google_glog//:glog",
        "@com_google_protobuf//:protobuf",
    ],
)

cc_test(
    name = "store_test",
    size = "small",
    srcs = ["store_test.cc"],
    deps = [
        ":store",
        "//cxx/clients/aggregator:standard_aggregator",
        "//cxx/clients/downsampler:standard_downsampler",
        "//cxx/clients/fileio:memory_fileio",
        "//cxx/clients/storage:fake_google3_storage",
        "//cxx/spec:fileio",
        "//cxx/testing:protocol-buffer-matchers",
        "//proto/clients/analyzers:threshold_analyzer_cc_proto",
        "//proto/helpers/rolling_window_reducer:rolling_window_reducer_cc_proto",
        "//proto/quickstore:quickstore_cc_proto",
        "//spec/cxx:fileio",
        "//spec/proto:mako_cc_proto",
        "@com_google_absl//absl/container:flat_hash_set",
        "@com_google_absl//absl/memory",
        "@com_google_glog//:glog",
        "@com_google_googletest//:gtest_main",
    ],
)
